{"title":"万能瓦片地图加载秘籍","date":"2020-04-13T05:38:08.000Z","date_formatted":{"ll":"Apr 13, 2020","L":"04/13/2020","MM-DD":"04-13"},"link":"2020/04/13/OpenLayers_7","comments":true,"tags":["OpenLayers","Source And Layer"],"categories":["学习笔记"],"updated":"2020-04-13T11:52:39.026Z","content":"<h3 id=\"瓦片结构\">瓦片结构<a href=\"#瓦片结构\" title=\"瓦片结构\"></a></h3><p><img src=\"http://anzhihun.coding.me/ol3-primer/img/lod.png\" class=\"φcy\" alt=\"Tile\"><br>这也是一个三维的结构，其中z用于表示地图层级，而xy表示某个层级内的瓦片平面，x为横轴坐标，y为纵轴坐标，类似于数学上常见的笛卡尔坐标系。</p>\n<h3 id=\"加载简单的瓦片地图\">加载简单的瓦片地图<a href=\"#加载简单的瓦片地图\" title=\"加载简单的瓦片地图\"></a></h3><p>如下图，可以通过这种方式来分辨所加载的地图类型，也可以通过这种方式来尝试分析地图中瓦片的坐标（在URL里）。<br><img src=\"http://anzhihun.coding.me/ol3-primer/img/baiduMap.png\" class=\"φcy\" alt=\"TileRequest\"><br>通过OpenLayers中的通用<code>Source</code>-&gt;<code>ol.source.XYZ</code>加载不同的瓦片地图源：</p>\n<ul><li><strong>Open Street Map地图：</strong> 其中url:<code>http://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png</code>里的<code>{a-c}</code>代表了url的subDomain,在请求时会随机的在url中使用a\\b\\c。而<code>{z}/{x}/{y}</code>则代表了该图片的三维坐标，其余部分为Open Street Map地图对应瓦片的域名。此url也是由Open Street Map地图官方定义的；<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"comment\">// Open Street Map 地图层</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> openStreetMapLayer = <span class=\"keyword\">new</span> ol.layer.Tile(&#123;</span><br><span class=\"line\">      source: <span class=\"keyword\">new</span> ol.source.XYZ(&#123;</span><br><span class=\"line\">          url: <span class=\"string\">'http://&#123;a-c&#125;.tile.openstreetmap.org/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;.png'</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 创建地图</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> map = <span class=\"keyword\">new</span> ol.Map(&#123;</span><br><span class=\"line\">      layers: [</span><br><span class=\"line\">          openStreetMapLayer</span><br><span class=\"line\">      ],</span><br><span class=\"line\">      view: <span class=\"keyword\">new</span> ol.View(&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 设置成都为地图中心</span></span><br><span class=\"line\">          center: [<span class=\"number\">104.06</span>, <span class=\"number\">30.67</span>],</span><br><span class=\"line\">          projection: <span class=\"string\">'EPSG:4326'</span>,</span><br><span class=\"line\">          zoom: <span class=\"number\">10</span></span><br><span class=\"line\">      &#125;),</span><br><span class=\"line\">      target: <span class=\"string\">'map'</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></li>\n<li><strong>高德地图：</strong> 编码方式与上述类似，而其url中格式的具体意义可以参照这两个网站：<a href=\"https://blog.csdn.net/qq_35732147/article/details/81317693\" target=\"_blank\">新旧高德地址</a>,<a href=\"http://www.thingjs.com/guide/cn/tutorial_Introduce/CityBuilder_Data.html\" target=\"_blank\">地图数据</a>。<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 高德地图层</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> gaodeMapLayer = <span class=\"keyword\">new</span> ol.layer.Tile(&#123;</span><br><span class=\"line\">    source: <span class=\"keyword\">new</span> ol.source.XYZ(&#123;</span><br><span class=\"line\">        url:<span class=\"string\">'http://webst0&#123;1-4&#125;.is.autonavi.com/appmaptile?lang=zh_cn&amp;size=1&amp;scale=1&amp;style=7&amp;x=&#123;x&#125;&amp;y=&#123;y&#125;&amp;z=&#123;z&#125;'</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></li>\n<li><strong>Yahoo地图：</strong> 其编码方式也是大同小异，只有一点不太一样，<font color=\"red\">即多了<code>tilleSize</code>参数的设置，也就是单个瓦片的尺寸的设置，</font>Yahoo地图使用的是512，而默认情况下为256，故在此需要指定。<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// yahoo地图层</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> yahooMapLayer = <span class=\"keyword\">new</span> ol.layer.Tile(&#123;</span><br><span class=\"line\">    source: <span class=\"keyword\">new</span> ol.source.XYZ(&#123;</span><br><span class=\"line\">        tileSize: <span class=\"number\">512</span>,</span><br><span class=\"line\">        url:<span class=\"string\">'https://&#123;0-3&#125;.base.maps.api.here.com/maptile/2.1/maptile/newest/normal.day/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;/512/png8?lg=ENG&amp;ppi=250&amp;token=TrLJuXVK62IQk0vuXFzaig%3D%3D&amp;requestid=yahoo.prod&amp;app_id=eAdkWGYRoc4RfxVo0Z4B'</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"瓦片地图坐标系\">瓦片地图坐标系<a href=\"#瓦片地图坐标系\" title=\"瓦片地图坐标系\"></a></h3>瓦片地图坐标系的定义方式：</li>\n<li>坐标原点：地图左上角（西北角）；</li>\n<li>正方向：向上为y轴正方向，向右为x轴正方向；</li>\n<li>具体地图方向：从北向南为y轴负方向，从西向东为x轴正方向；<h3 id=\"瓦片地图-gt百度地图\">瓦片地图-&gt;百度地图<a href=\"#瓦片地图-gt百度地图\" title=\"瓦片地图-&gt;百度地图\"></a></h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"comment\">// 百度地图层</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> baiduMapLayer = <span class=\"keyword\">new</span> ol.layer.Tile(&#123;</span><br><span class=\"line\">      source: <span class=\"keyword\">new</span> ol.source.XYZ(&#123;</span><br><span class=\"line\">          tilePixelRatio: <span class=\"number\">2</span>,</span><br><span class=\"line\">          tileUrlFunction: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">tileCoord</span>)</span>&#123;  <span class=\"comment\">// 参数tileCoord为瓦片坐标</span></span><br><span class=\"line\">              <span class=\"keyword\">var</span> z = tileCoord[<span class=\"number\">0</span>];</span><br><span class=\"line\">      <span class=\"keyword\">var</span> x = tileCoord[<span class=\"number\">1</span>];</span><br><span class=\"line\">      <span class=\"keyword\">var</span> y = tileCoord[<span class=\"number\">2</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 计算当前层级下瓦片总数的一半，用于定位整个地图的中心点</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> halfTileNum = <span class=\"built_in\">Math</span>.pow(<span class=\"number\">2</span>, z<span class=\"number\">-1</span>);</span><br><span class=\"line\">      <span class=\"comment\">// 原点移到中心点后，计算xy方向上新的坐标位置</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> baiduX =  x - halfTileNum;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> baiduY =  y + halfTileNum;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 百度瓦片服务url将负数使用M前缀来标识</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (baiduX &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          baiduX = <span class=\"string\">'M'</span> + (-baiduX);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (baiduY &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          baiduY = <span class=\"string\">'M'</span> + (-baiduY);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 返回经过转换后，对应于百度在线瓦片的url</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">'http://online2.map.bdimg.com/onlinelabel/?qt=tile&amp;x='</span> + baiduX + <span class=\"string\">'&amp;y='</span> + baiduY + <span class=\"string\">'&amp;z='</span> + z + <span class=\"string\">'&amp;styles=pl&amp;udt=20160321&amp;scaler=2&amp;p=0'</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 创建地图</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> map = <span class=\"keyword\">new</span> ol.Map(&#123;</span><br><span class=\"line\">      layers: [</span><br><span class=\"line\">          baiduMapLayer</span><br><span class=\"line\">      ],</span><br><span class=\"line\">      view: <span class=\"keyword\">new</span> ol.View(&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 设置成都为地图中心</span></span><br><span class=\"line\">          center: [<span class=\"number\">104.06</span>, <span class=\"number\">30.67</span>],</span><br><span class=\"line\">          projection: <span class=\"string\">'EPSG:4326'</span>,</span><br><span class=\"line\">          zoom: <span class=\"number\">4</span></span><br><span class=\"line\">      &#125;),</span><br><span class=\"line\">      target: <span class=\"string\">'baiduMap'</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n由于<font color=\"red\">百度的原点在中心点的位置</font>，所以在用Openlayers加载百度地图的时候，需要进行坐标的调整，以保证中心位置的准确，这主要是通过自定义函数<code>tileUrlFunction</code>实现的。<br>其中步骤主要有以下几步：</li>\n<li>将瓦片地图的比率<code>tilePixelRatio</code>设为2，以适应百度地图的瓦片大小；</li>\n<li>获取默认坐标系下的瓦片坐标（原点在左上角），然后将这些坐标值都传给已定义好的变量<code>x/y/z</code>；</li>\n<li>通过<code>Math.pow(2, z-1)</code>-&gt;2^(z-1)计算当前地图层级下瓦片总数的一半，用于定位整个地图的中心点；</li>\n<li>然后通过计算xy方向上新的坐标位置，来将原点移到中心点；</li>\n<li>同时，由于在百度瓦片服务url中会将<font color=\"red\">负数用’M’前缀来标识</font>，这里需要增加一步转换的操作，方便将数值传给百度在线瓦片的url；</li>\n<li>最后将计算好的瓦片坐标传入百度在线瓦片的url，作为一个新的图层进行显示；<br>&nbsp;&nbsp;<br>但即使如此，最后显示出来的地图中心仍然不是成都，而且本例中的转换坐标并没有起到作用，归根结底应该算是<font color=\"red\">OpenLayers 3的分辨率和百度在线瓦片地图使用的分辨率对不上</font>导致的。<h3 id=\"瓦片地图-gt百度地图-gt重定义openlayers-3的瓦片坐标系\">瓦片地图-&gt;百度地图-&gt;重定义OpenLayers 3的瓦片坐标系<a href=\"#瓦片地图-gt百度地图-gt重定义openlayers-3的瓦片坐标系\" title=\"瓦片地图-&gt;百度地图-&gt;重定义OpenLayers 3的瓦片坐标系\"></a></h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"comment\">// 自定义分辨率和瓦片坐标系</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> resolutions = [];</span><br><span class=\"line\"><span class=\"keyword\">var</span> maxZoom = <span class=\"number\">18</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 计算百度使用的分辨率</span></span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i&lt;=maxZoom; i++)&#123;</span><br><span class=\"line\">    resolutions[i] = <span class=\"built_in\">Math</span>.pow(<span class=\"number\">2</span>, maxZoom-i);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> tilegrid  = <span class=\"keyword\">new</span> ol.tilegrid.TileGrid(&#123;</span><br><span class=\"line\">    origin: [<span class=\"number\">0</span>,<span class=\"number\">0</span>],    <span class=\"comment\">// 设置原点坐标</span></span><br><span class=\"line\">    resolutions: resolutions    <span class=\"comment\">// 设置分辨率</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 创建百度地图的数据源</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> baiduSource = <span class=\"keyword\">new</span> ol.source.TileImage(&#123;</span><br><span class=\"line\">    projection: <span class=\"string\">'EPSG:3857'</span>,    </span><br><span class=\"line\">    tileGrid: tilegrid,</span><br><span class=\"line\">    tileUrlFunction: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">tileCoord, pixelRatio, proj</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> z = tileCoord[<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = tileCoord[<span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = tileCoord[<span class=\"number\">2</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 百度瓦片服务url将负数使用M前缀来标识</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x&lt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            x = <span class=\"string\">'M'</span> + (-x);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(y&lt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            y = <span class=\"string\">'M'</span> + (-y);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"http://online0.map.bdimg.com/onlinelabel/?qt=tile&amp;x=\"</span>+x+<span class=\"string\">\"&amp;y=\"</span>+y+<span class=\"string\">\"&amp;z=\"</span>+z+<span class=\"string\">\"&amp;styles=pl&amp;udt=20160426&amp;scaler=1&amp;p=0\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 百度地图层</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> baiduMapLayer2 = <span class=\"keyword\">new</span> ol.layer.Tile(&#123;</span><br><span class=\"line\">      source: baiduSource</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 创建地图</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> ol.Map(&#123;</span><br><span class=\"line\">      layers: [</span><br><span class=\"line\">          baiduMapLayer2</span><br><span class=\"line\">      ],</span><br><span class=\"line\">      view: <span class=\"keyword\">new</span> ol.View(&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 设置成都为地图中心</span></span><br><span class=\"line\">          center: ol.proj.transform([<span class=\"number\">104.06</span>, <span class=\"number\">30.67</span>], <span class=\"string\">'EPSG:4326'</span>, <span class=\"string\">'EPSG:3857'</span>),</span><br><span class=\"line\">          zoom: <span class=\"number\">10</span></span><br><span class=\"line\">      &#125;),</span><br><span class=\"line\">      target: <span class=\"string\">'baiduMap2'</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n上述过程也是<font color=\"red\">重新定义OpenLayers 3瓦片坐标使之与百度在线瓦片坐标一致的过程</font>，以使OpenLayers能够比较适和的显示百度地图。<br>其中主要是引入了 <strong><code>ol.tilegrid.TileGrid</code></strong>  这一函数:</li>\n<li>首先，定义两个变量<code>resolutions</code>和<code>maxZoom</code>，建立一个装载分辨率和瓦片坐标系的容器；</li>\n<li>其次，获取百度地图使用的分辨率，也就是相对应的缩放级别的瓦片数量，即一定大小的空间的像元数量；</li>\n<li>然后，通过<code>ol.tilegrid.TileGrid</code>函数将前面获取的分辨率和坐标系放在一起建立一个新的瓦片网格，也就是一个适合百度地图的新坐标系；</li>\n<li>最后，通过<code>ol.source.TileImage</code>即<code>ol.source.XYZ</code>的父类，将前面定义好的格网或坐标系封装为一个百度地图类型的数据源，赋给<code>ol.layer.Tile</code>用以显示百度地图在线瓦片；</li>\n<li><font color=\"red\">注意：</font>在默认情况下，地图的坐标系的正负向是按照数学上通常定义的笛卡尔坐标系设定，也就是从左向右为x正方向，从下向上为y轴正方向。<h3 id=\"解密瓦片地图url\">解密瓦片地图url<a href=\"#解密瓦片地图url\" title=\"解密瓦片地图url\"></a></h3></li>\n<li>第一种，请求瓦片的url明确有xyz参数，如高德地图和百度地图，最为简单；</li>\n<li>第二种，请求的<code>xyz</code>作为路径直接存于<code>url</code>，但是并没有明确的参数哪些是xyz，比如Open Street Map和Yahoo地图。其地图服务器接收到请求后，就直接在服务器按照这个路径获取图片了；</li>\n<li>第三种，地图服务提供商为了防止大家直接非法使用瓦片地图，对瓦片的url进行了加密，比如现在的微软Bing中文地图和Google地图，只有知道如何解密才能使用。<h3 id=\"加载微软bing中文地图\">加载微软Bing中文地图<a href=\"#加载微软bing中文地图\" title=\"加载微软Bing中文地图\"></a></h3><img src=\"http://anzhihun.coding.me/ol3-primer/img/bingmap-zh.png\" class=\"φcy\" alt=\"BingMap\"><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Bing中文地图层</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> bingMapLayer = <span class=\"keyword\">new</span> ol.layer.Tile(&#123;</span><br><span class=\"line\">    source: <span class=\"keyword\">new</span> ol.source.XYZ(&#123;</span><br><span class=\"line\">        tileUrlFunction: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">tileCoord</span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> z = tileCoord[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">var</span> x = tileCoord[<span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"keyword\">var</span> y = -tileCoord[<span class=\"number\">2</span>] - <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result=<span class=\"string\">''</span>, zIndex=<span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(; zIndex&lt;z; zIndex++) &#123;</span><br><span class=\"line\">        result = ((x&amp;<span class=\"number\">1</span>)+<span class=\"number\">2</span>*(y&amp;<span class=\"number\">1</span>)).toString() + result;</span><br><span class=\"line\">        x &gt;&gt;= <span class=\"number\">1</span>;</span><br><span class=\"line\">        y &gt;&gt;= <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'http://dynamic.t0.tiles.ditu.live.com/comp/ch/'</span> + result + <span class=\"string\">'?it=G,VE,BX,L,LA&amp;mkt=zh-cn,syr&amp;n=z&amp;og=111&amp;ur=CN'</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"加载google地图\">加载Google地图<a href=\"#加载google地图\" title=\"加载Google地图\"></a></h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"comment\">// google地图层</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> googleMapLayer = <span class=\"keyword\">new</span> ol.layer.Tile(&#123;</span><br><span class=\"line\">      source: <span class=\"keyword\">new</span> ol.source.XYZ(&#123;</span><br><span class=\"line\">          url:<span class=\"string\">'http://www.google.cn/maps/vt/pb=!1m4!1m3!1i&#123;z&#125;!2i&#123;x&#125;!3i&#123;y&#125;!2m3!1e0!2sm!3i345013117!3m8!2szh-CN!3scn!5e1105!12m4!1e68!2m2!1sset!2sRoadmap!4e0'</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 创建地图</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> map = <span class=\"keyword\">new</span> ol.Map(&#123;</span><br><span class=\"line\">      layers: [</span><br><span class=\"line\">          googleMapLayer</span><br><span class=\"line\">      ],</span><br><span class=\"line\">      view: <span class=\"keyword\">new</span> ol.View(&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 设置成都为地图中心</span></span><br><span class=\"line\">          center: [<span class=\"number\">104.06</span>, <span class=\"number\">30.67</span>],</span><br><span class=\"line\">          projection: <span class=\"string\">'EPSG:4326'</span>,</span><br><span class=\"line\">          zoom: <span class=\"number\">10</span></span><br><span class=\"line\">      &#125;),</span><br><span class=\"line\">      target: <span class=\"string\">'googleMap'</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></li>\n</ul>","next":{"title":"初步解析地图组成（OSM）","link":"2020/04/05/OpenLayers_1"},"plink":"http://yoursite.com/2020/04/13/OpenLayers_7/","toc":[{"id":"瓦片结构","title":"瓦片结构","index":"1"},{"id":"加载简单的瓦片地图","title":"加载简单的瓦片地图","index":"2"},{"id":"瓦片地图坐标系","title":"瓦片地图坐标系","index":"3"},{"id":"瓦片地图-gt百度地图","title":"瓦片地图-&gt;百度地图","index":"4"},{"id":"瓦片地图-gt百度地图-gt重定义openlayers-3的瓦片坐标系","title":"瓦片地图-&gt;百度地图-&gt;重定义OpenLayers 3的瓦片坐标系","index":"5"},{"id":"解密瓦片地图url","title":"解密瓦片地图url","index":"6"},{"id":"加载微软bing中文地图","title":"加载微软Bing中文地图","index":"7"},{"id":"加载google地图","title":"加载Google地图","index":"8"}],"reward":true,"copyright":{"custom":"<b>Copyright : </b>&nbsp 自由转载-非商用-禁止演绎-保持署名（CC BY-NC-ND 4.0） <br/>  <b>Link :</b> &nbsp<a href=\"https://qlqy.github.io\">https://qlqy.github.io</a>"}}